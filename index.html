<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🎮 Dating Quest</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#764ba2">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Dating Quest">
    <link rel="apple-touch-icon" href="icon-192.png">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --vertical-stretch: 1.0;
            --padding-multiplier: 1.0;
            --font-multiplier: 1.0;
            --margin-multiplier: 1.0;
            --border-radius-multiplier: 1.0;
            --button-size-multiplier: 1.0;
            --opacity-multiplier: 1.0;
            --spacing-multiplier: 1.0;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            width: 100vw;
            max-width: 412px;
            max-height: 915px;
            color: white;
            overflow: hidden;
            margin: 0 auto;
            transform: scaleY(var(--vertical-stretch));
            transform-origin: top;
        }

        .container {
            max-width: 412px;
            width: 100%;
            margin: 0 auto;
            padding: calc(6px * var(--padding-multiplier));
            height: 100vh;
            max-height: 915px;
            display: flex;
            flex-direction: column;
        }

        .header {
            text-align: center;
            margin-bottom: 8px;
            flex-shrink: 0;
        }

        .header h1 {
            font-size: 1.2em;
            margin-bottom: 3px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .level-info {
            background: rgba(255,255,255,calc(0.1 * var(--opacity-multiplier)));
            border-radius: calc(6px * var(--border-radius-multiplier));
            padding: calc(6px * var(--padding-multiplier));
            margin-bottom: calc(6px * var(--spacing-multiplier));
            backdrop-filter: blur(10px);
            flex-shrink: 0;
        }

        .level {
            font-size: 0.8em;
            font-weight: bold;
            margin-bottom: 3px;
        }

        .xp-bar {
            background: rgba(0,0,0,0.2);
            border-radius: 4px;
            height: 10px;
            overflow: hidden;
            margin-bottom: 3px;
        }

        .xp-fill {
            background: linear-gradient(90deg, #4CAF50, #8BC34A);
            height: 100%;
            transition: width 0.3s ease;
            border-radius: 4px;
        }

        .xp-text {
            text-align: center;
            font-size: 0.6em;
        }

        .streak {
            text-align: center;
            font-size: 0.7em;
            color: #FFD700;
        }

        .daily-approaches {
            text-align: center;
            font-size: 0.7em;
            color: #4CAF50;
            font-weight: bold;
        }

        .section {
            background: rgba(255,255,255,calc(0.1 * var(--opacity-multiplier)));
            border-radius: calc(6px * var(--border-radius-multiplier));
            padding: calc(6px * var(--padding-multiplier));
            margin-bottom: calc(4px * var(--spacing-multiplier));
            backdrop-filter: blur(10px);
            flex-shrink: 0;
        }

        .section h2 {
            margin-bottom: 4px;
            font-size: 0.8em;
        }

        .quest-item {
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            padding: 4px;
            margin-bottom: 3px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.7em;
        }

        .quest-item:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-2px);
        }

        .quest-item.completed {
            background: rgba(76, 175, 80, 0.3);
            text-decoration: line-through;
        }

        .xp-button {
            background: linear-gradient(45deg, #FF6B6B, #FF8E53);
            border: none;
            border-radius: calc(12px * var(--border-radius-multiplier));
            color: white;
            padding: calc(4px * var(--button-size-multiplier)) calc(8px * var(--button-size-multiplier));
            margin: calc(1px * var(--spacing-multiplier));
            cursor: pointer;
            font-weight: bold;
            font-size: 0.6em;
            transition: all 0.3s ease;
            box-shadow: 0 1px 4px rgba(0,0,0,0.2);
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .xp-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .xp-button:active {
            transform: translateY(0);
        }

        .randomizer {
            text-align: center;
            margin: 8px 0;
        }

        .randomizer-button {
            background: linear-gradient(45deg, #9C27B0, #E91E63);
            border: none;
            border-radius: 20px;
            color: white;
            padding: 8px 16px;
            font-size: 0.8em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .randomizer-button:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .random-result {
            background: rgba(255,255,255,0.2);
            border-radius: 8px;
            padding: 8px;
            margin-top: 8px;
            font-size: 0.8em;
            text-align: center;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .achievement {
            background: rgba(255,255,255,0.1);
            border-radius: 6px;
            padding: 6px;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
            font-size: 0.8em;
        }

        .achievement.unlocked {
            background: rgba(255, 215, 0, 0.3);
            border: 2px solid #FFD700;
        }

        .achievement-icon {
            font-size: 2em;
            margin-right: 15px;
        }

        .achievement-text {
            flex: 1;
        }

        .achievement-title {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .achievement-desc {
            font-size: 0.9em;
            opacity: 0.8;
        }

        .hidden {
            display: none;
        }

        .tab-container {
            display: flex;
            margin-bottom: 4px;
            background: rgba(255,255,255,0.1);
            border-radius: 6px;
            padding: 2px;
            flex-shrink: 0;
        }

        .tab {
            flex: 1;
            background: none;
            border: none;
            color: white;
            padding: 3px 1px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.6em;
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .tab.active {
            background: rgba(255,255,255,0.2);
        }

        .start-over-button {
            background: linear-gradient(45deg, #ff4444, #cc0000);
            border: none;
            border-radius: 8px;
            color: white;
            padding: 8px 16px;
            margin: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.8em;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .start-over-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.4);
        }

        .tab-content {
            display: none;
            flex: 1;
            overflow-y: auto;
            padding: 4px;
            max-height: 400px;
        }

        .scrollable-content {
            max-height: 300px;
            overflow-y: auto;
            padding: 4px;
        }

        .scrollable-content::-webkit-scrollbar {
            width: 6px;
        }

        .scrollable-content::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
        }

        .scrollable-content::-webkit-scrollbar-thumb {
            background: rgba(255,255,255,0.3);
            border-radius: 3px;
        }

        .scrollable-content::-webkit-scrollbar-thumb:hover {
            background: rgba(255,255,255,0.5);
        }

        .tab-content.active {
            display: flex;
            flex-direction: column;
        }

        .xp-log-item {
            background: rgba(255,255,255,0.1);
            border-radius: 6px;
            padding: 6px;
            margin-bottom: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8em;
        }

        .xp-log-item .action {
            font-weight: bold;
        }

        .xp-log-item .xp {
            color: #4CAF50;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎮 Dating Quest</h1>
        </div>

        <div class="level-info">
            <div class="level">Level <span id="currentLevel">1</span> - <span id="levelTitle">Beginner</span></div>
            <div class="xp-bar">
                <div class="xp-fill" id="xpBar" style="width: 0%"></div>
            </div>
            <div class="xp-text"><span id="currentXP">0</span> / <span id="nextLevelXP">50</span> XP</div>
            <div class="streak">🔥 Streak: <span id="streak">0</span> days</div>
            <div class="daily-approaches">📊 Today's Approaches: <span id="dailyApproaches">0</span></div>
            <button class="start-over-button" onclick="startOver()">🔄 Start Over</button>
        </div>

        <div class="tab-container">
            <button class="tab active" onclick="showTab('home')">🏠 Home</button>
            <button class="tab" onclick="showTab('quests')">📋 Quests</button>
            <button class="tab" onclick="showTab('randomizer')">🎲 Randomizer</button>
            <button class="tab" onclick="showTab('log')">📊 Log</button>
            <button class="tab" onclick="showTab('achievements')">🏆 Achievements</button>
        </div>

        <!-- Home Tab -->
        <div id="home" class="tab-content active">
            <div class="section">
                <h2>Today's Quests</h2>
                <div id="dailyQuests"></div>
            </div>
            
            <div class="section">
                <h2>Quick Actions</h2>
                <div style="display: flex; flex-wrap: wrap; justify-content: center;">
                    <button class="xp-button" onclick="addXP('eye_contact_smile', 2)">👁️ Smile (+2)</button>
                    <button class="xp-button" onclick="addXP('greeting', 3)">👋 Hello (+3)</button>
                    <button class="xp-button" onclick="addXP('start_conversation', 5)">💬 Talk (+5)</button>
                    <button class="xp-button" onclick="addXP('ask_question', 6)">❓ Question (+6)</button>
                    <button class="xp-button" onclick="addXP('make_laugh', 8)">😄 Make Laugh (+8)</button>
                    <button class="xp-button" onclick="addXP('compliment', 8)">💝 Compliment (+8)</button>
                    <button class="xp-button" onclick="addXP('ask_out', 10)">💕 Ask Out (+10)</button>
                    <button class="xp-button" onclick="addXP('get_number', 15)">📱 Get Number (+15)</button>
                    <button class="xp-button" onclick="addApproach()" style="background: linear-gradient(45deg, #4CAF50, #45a049);">📊 Add Approach</button>
                </div>
            </div>
        </div>

        <!-- Quests Tab -->
        <div id="quests" class="tab-content">
            <div class="section">
                <h2>Daily Quests</h2>
                <div id="questList"></div>
            </div>
        </div>

        <!-- Randomizer Tab -->
        <div id="randomizer" class="tab-content">
            <div class="section">
                <h2>🎲 Approach Randomizer</h2>
                <div class="randomizer">
                    <button class="randomizer-button" onclick="rollRandomizer()">Roll New Approach!</button>
                    <div class="random-result" id="randomResult">
                        Click the button to get a random approach style!
                    </div>
                </div>
            </div>
        </div>

        <!-- Log Tab -->
        <div id="log" class="tab-content">
            <div class="section">
                <h2>XP Log</h2>
                <div class="scrollable-content">
                <div id="xpLog"></div>
                </div>
            </div>
        </div>

        <!-- Achievements Tab -->
        <div id="achievements" class="tab-content">
            <div class="section">
                <h2>🏆 Achievements</h2>
                <div class="scrollable-content">
                <div id="achievementList"></div>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        // UI Configuration - Adjust these values to fit your screen
        const UI_CONFIG = {
            verticalStretch: 1.6,  // 1.0 = normal, 1.2 = 20% taller, 0.8 = 20% shorter
            paddingMultiplier: 1.0, // 1.0 = normal padding, 1.5 = more padding, 0.5 = less padding
            fontMultiplier: 1.0,   // 1.0 = normal font size, 1.2 = 20% larger, 0.8 = 20% smaller
            marginMultiplier: 1.0,  // 1.0 = normal margins, 1.5 = more space, 0.5 = tighter
            borderRadiusMultiplier: 1.0, // 1.0 = normal rounded corners, 1.5 = more rounded, 0.5 = less rounded
            buttonSizeMultiplier: 1.0,   // 1.0 = normal button size, 1.2 = bigger buttons, 0.8 = smaller
            opacityMultiplier: 1.0,      // 1.0 = normal opacity, 0.8 = more transparent, 1.2 = more opaque
            spacingMultiplier: 1.0       // 1.0 = normal spacing, 1.5 = more space between elements, 0.5 = tighter
        };

        // Apply UI configuration
        function applyUIConfig() {
            document.documentElement.style.setProperty('--vertical-stretch', UI_CONFIG.verticalStretch);
            document.documentElement.style.setProperty('--padding-multiplier', UI_CONFIG.paddingMultiplier);
            document.documentElement.style.setProperty('--font-multiplier', UI_CONFIG.fontMultiplier);
            document.documentElement.style.setProperty('--margin-multiplier', UI_CONFIG.marginMultiplier);
            document.documentElement.style.setProperty('--border-radius-multiplier', UI_CONFIG.borderRadiusMultiplier);
            document.documentElement.style.setProperty('--button-size-multiplier', UI_CONFIG.buttonSizeMultiplier);
            document.documentElement.style.setProperty('--opacity-multiplier', UI_CONFIG.opacityMultiplier);
            document.documentElement.style.setProperty('--spacing-multiplier', UI_CONFIG.spacingMultiplier);
        }

        // Apply config on load
        applyUIConfig();

        // Test functions for UI adjustment
        function testVerticalStretch(value) {
            UI_CONFIG.verticalStretch = value;
            applyUIConfig();
            console.log('Vertical stretch set to:', value);
        }

        function testPaddingMultiplier(value) {
            UI_CONFIG.paddingMultiplier = value;
            applyUIConfig();
            console.log('Padding multiplier set to:', value);
        }

        function testFontMultiplier(value) {
            UI_CONFIG.fontMultiplier = value;
            applyUIConfig();
            console.log('Font multiplier set to:', value);
        }

        function testMarginMultiplier(value) {
            UI_CONFIG.marginMultiplier = value;
            applyUIConfig();
            console.log('Margin multiplier set to:', value);
        }

        function testBorderRadiusMultiplier(value) {
            UI_CONFIG.borderRadiusMultiplier = value;
            applyUIConfig();
            console.log('Border radius multiplier set to:', value);
        }

        function testButtonSizeMultiplier(value) {
            UI_CONFIG.buttonSizeMultiplier = value;
            applyUIConfig();
            console.log('Button size multiplier set to:', value);
        }

        function testOpacityMultiplier(value) {
            UI_CONFIG.opacityMultiplier = value;
            applyUIConfig();
            console.log('Opacity multiplier set to:', value);
        }

        function testSpacingMultiplier(value) {
            UI_CONFIG.spacingMultiplier = value;
            applyUIConfig();
            console.log('Spacing multiplier set to:', value);
        }

        // Reset to default values
        function resetToDefaults() {
            UI_CONFIG.verticalStretch = 1.0;
            UI_CONFIG.paddingMultiplier = 1.0;
            UI_CONFIG.fontMultiplier = 1.0;
            UI_CONFIG.marginMultiplier = 1.0;
            UI_CONFIG.borderRadiusMultiplier = 1.0;
            UI_CONFIG.buttonSizeMultiplier = 1.0;
            UI_CONFIG.opacityMultiplier = 1.0;
            UI_CONFIG.spacingMultiplier = 1.0;
            applyUIConfig();
            console.log('Reset to default values');
        }

        // Start Over function
        function startOver() {
            if (confirm('Are you sure you want to start over? This will reset all your progress!')) {
                // Reset game data
                game.gameData = {
                    totalXP: 0,
                    currentLevelXP: 0,
                    level: 1,
                    stats: {
                        approach: 0,
                        eye_contact_smile: 0,
                        greeting: 0,
                        start_conversation: 0,
                        ask_question: 0,
                        make_laugh: 0,
                        compliment: 0,
                        ask_out: 0,
                        get_number: 0,
                        long_conversation: 0,
                        handle_rejection: 0,
                        secure_date: 0,
                        approach_group: 0,
                        new_opener: 0,
                        mass_approach: 0,
                        conversations: 0
                    },
                    xpLog: [],
                    dailyQuests: [],
                    completedQuests: [],
                    achievements: [],
                    streak: 0,
                    lastActiveDate: null
                };
                
                // Reset daily approaches
                game.dailyApproaches = 0;
                
                // Save and update display
                game.saveGameData();
                game.updateDisplay();
                game.updateQuestList();
                game.updateAchievements();
                game.updateStreak();
                game.updateApproachCounter();
                
                alert('Progress reset! You can start fresh now.');
            }
        }

        // Make functions globally available for testing
        window.testVerticalStretch = testVerticalStretch;
        window.testPaddingMultiplier = testPaddingMultiplier;
        window.testFontMultiplier = testFontMultiplier;
        window.testMarginMultiplier = testMarginMultiplier;
        window.testBorderRadiusMultiplier = testBorderRadiusMultiplier;
        window.testButtonSizeMultiplier = testButtonSizeMultiplier;
        window.testOpacityMultiplier = testOpacityMultiplier;
        window.testSpacingMultiplier = testSpacingMultiplier;
        window.resetToDefaults = resetToDefaults;
        window.startOver = startOver;

        // Register Service Worker for PWA functionality
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('./sw.js')
                    .then(function(registration) {
                        console.log('ServiceWorker registration successful');
                        // Force update the service worker
                        registration.update();
                    })
                    .catch(function(err) {
                        console.log('ServiceWorker registration failed:', err);
                    });
            });
        }

        // Fix touch events for mobile - Complete rewrite
        function addTouchSupport() {
            console.log('Adding touch support...');
            
            // Remove all existing touch listeners first
            document.removeEventListener('touchstart', handleTouchStart);
            document.removeEventListener('touchend', handleTouchEnd);
            
            // Add global touch handlers
            document.addEventListener('touchstart', handleTouchStart, { passive: false });
            document.addEventListener('touchend', handleTouchEnd, { passive: false });
            
            // Prevent context menu
            document.addEventListener('contextmenu', function(e) {
                e.preventDefault();
            });
        }
        
        function handleTouchStart(e) {
            // Only prevent default for interactive elements
            if (e.target.tagName === 'BUTTON' || 
                e.target.hasAttribute('onclick') || 
                e.target.classList.contains('quest-item') ||
                e.target.classList.contains('tab')) {
                e.preventDefault();
                e.stopPropagation();
                e.target.style.opacity = '0.7'; // Visual feedback
            }
        }
        
        function handleTouchEnd(e) {
            if (e.target.tagName === 'BUTTON' || 
                e.target.hasAttribute('onclick') || 
                e.target.classList.contains('quest-item') ||
                e.target.classList.contains('tab')) {
                e.preventDefault();
                e.stopPropagation();
                e.target.style.opacity = '1'; // Reset visual feedback
                
                
                // Trigger click
                if (e.target.tagName === 'BUTTON') {
                    e.target.click();
                } else if (e.target.hasAttribute('onclick')) {
                    // Execute onclick directly
                    const onclick = e.target.getAttribute('onclick');
                    if (onclick) {
                        eval(onclick);
                    }
                } else if (e.target.classList.contains('quest-item')) {
                    // Handle quest item click
                    const questIndex = e.target.getAttribute('data-quest-index');
                    if (questIndex !== null) {
                        game.completeQuest(parseInt(questIndex));
                    }
                } else if (e.target.classList.contains('tab')) {
                    // Handle tab click
                    const tabName = e.target.getAttribute('onclick').match(/showTab\('([^']+)'\)/);
                    if (tabName) {
                        showTab(tabName[1]);
                    }
                }
            }
        }

        // Global functions
        function addApproach() {
            game.addApproach();
        }

        // Initialize touch support when page loads
        window.addEventListener('load', addTouchSupport);
        
        // Also add touch support after a delay to catch dynamically created elements
        setTimeout(addTouchSupport, 1000);
        
        // Add touch support to any new elements that get created
        const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                if (mutation.type === 'childList') {
                    addTouchSupport();
                }
            });
        });
        observer.observe(document.body, { childList: true, subtree: true });
    </script>
</body>
</html>
